<html>
<body>
<script type='text/javascript' src='../../index.js'></script>
<script>
function getmirrors(index){
var ret='';
if (index==0) ret='https://hls-js.netlify.com/dist/hls.js';
if (index==1) ret='https://cdn.jsdelivr.net/npm/hls.js@latest';
if (index==2) ret='http://cdn.jsdelivr.net/npm/hls.js@latest';
return ret;
}
var mediafile=decodeURIComponent($_GET('media'));
var width=Math.floor((window.screen.height*100)/window.screen.width)+'%';
var height=Math.floor((window.screen.height*100)/window.screen.width)+'%';
var scriptmirror=0;
if (!$_GET('width')=='') width=decodeURIComponent($_GET('width'));
if (!$_GET('height')=='') height=decodeURIComponent($_GET('height'));
if (!$_GET('mirror')=='') scriptmirror=$_GET('mirror');
if (mediafile=='') {
    document.write("Enter media file URL:<input type='text' size='50' id='media'/><br/>"+
                   "Enter player width:<input type='text' id='width' value='"+Math.floor((window.screen.height*100)/window.screen.width)+"%'/>"+
                   "Enter player height:<input type='text' id='height' value='"+Math.floor((window.screen.height*100)/window.screen.width)+"%'/>");
    document.write("Cloud script mirror<select id='mirror'></select>");
    scriptmirrorselect = document.getElementById('mirror');
    for(i=0;i<3;i++) scriptmirrorselect.options[scriptmirrorselect.options.length] = new Option(getmirrors(i),i);
    document.write("<input type='hidden' id='isembedded' value='0'>"+
                    "<input type='button' value='Submit' onclick='submit()'><br>");
    scriptmirrorselect.selectedIndex=scriptmirror;  
}

function submit(){
formsubmit(['media','width','height','mirror']);
}

function embedcode(){
var embedURL=window.location.protocol + '//' + window.location.hostname + window.location.pathname;
embedURL+='?media='+$_GET('media');
embedURL+='&width='+$_GET('width');
embedURL+='&height='+$_GET('height');
embedURL+='&mirror='+$_GET('mirror');
embedURL+='&isembedded=1';
var embedcode="&lt;iframe src=&apos;"+embedURL+"&apos; width=&apos;"+width+"&apos; height=&apos;"+height+"&apos; allowfullscreen=&apos;true&apos;/&gt;";
var out='Embed code: <input type="text" size="148" value="'+embedcode+'" readyonly>'; 
return out;
}

function play(media,mirror){
document.write('<video id="video" width="'+width+'" height="'+height+'" controls></video>');
var script = document.createElement("script");
script.type = "text/javascript";
script.src = getmirrors(mirror);
script.onload = function(){
if(Hls.isSupported()) {
    var video = document.getElementById('video');
    var config = {
       liveBackBufferLength : 3600,
       maxBufferLength: 30,
       maxBufferSize : 1024*1024*1024,
       maxMaxBufferLength : 3600
    };
    var hls = new Hls(config);
    hls.attachMedia(video);
    var playcounter=0;
    video.addEventListener(
    'play',
    function() {
        if (playcounter==0) hls.loadSource(media);
        video.play();
        playcounter=1;
    },
    false);
}}
document.body.appendChild(script);
}

if (!$_GET('media')==''&&!$_GET('isembedded')=='1') document.write(embedcode()+"<br><a href='index.html'>Restart</a><br>");
if (!$_GET('media')=='') play(mediafile,scriptmirror);
if (!$_GET('isembedded')=='1') document.write("<br><a href='../index.html'>Exit</a>");
</script>
</body></html>